

<!DOCTYPE HTML>

<html>

	<head>

		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-31351295-1"></script>
		<script>
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'UA-31351295-1');
		</script>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<title>The Blog</title>
		<style>
			body { font-family: 'Vollkorn', serif; }
			code { background-color: #fffdf7; }
			.clickable {
				font-size: 12px;
				font-weight: 100;
				color: blue;
				text-decoration: underline;
				cursor: pointer;
			}
		</style>
	</head>

	<body>

		<header>
			<h1>This is my blog...
				<sub><i style="font-size: 12px;">sorry, not sorry?</i></sub>
			</h1>
		</header>
		<hr>
		<section>
			<!-- POSTS ARE INSERTED HERE AT BUILDTIME  -->
			<article>
	<header>
		<h3>
			BLOG TITLE GOES HERE
			<span class="view clickable">
				Show
			</span>
		</h3>
	</header>

	<div style="display: none">
		<i><p>Posted on <time>DOW MMM DD YYYY</time> by <a href="#about">forrestbthomas</a></p></i>
		<p>BLOG CONTENT GOES HERE</p>
	</div>
</article>
<hr>
<article>
	<header>
		<h3>
			Immutability Still Breaks My Brain
			<span class="view clickable" onclick="toggleView(this);">
				Show
			</span>

		</h3>
	</header>
	<div style="display: none;">

		<i><p>Posted on <time>Sat Jan 20 2018</time> by <a href="#about">forrestbthomas</a></p></i>
		<p>I mentioned in my first post some snarky comment about reversing a Linked List and its correlation to productive software engineering (apologies for the snark, I should probably work on that) and it made me wonder if I could manage to write the necessary algorithm in an immutable way. I've been learning Clojure for about 6 months now and I feel like I'm getting the hang of it. I'm not a pro by any means, but the basic concepts of immutability, parallelism and a "functional" style of programming seem to have coalesced to a greater or lesser extent. So, I figured, why not try to implement something that I felt confident enough about to be snarky?</p>
		<p>As it would so turn out, the problem was a little more difficult than I anticipated. I can't tell if that implies I have a long way to go in learning Clojure or if that means I don't have as solid of an understanding of the underlying data structure and algorithm as I thought I did, or some combination of both. Regardless, it was a fun little exercise and I figured I'd share what I learned. I guess it makes sense just to walk through the various code blocks needed for the problem.</p>
		<p>As you might imagine, when implementing a Linked List and reversing it, I need the standard <code>Node</code> and <code>List</code> data structures:
		<pre>
<code class="clojure">
;; Node Data Structure
(defn new-node
  [v]
  (assoc {} :val v :next nil))

;; List Data Structure
(defn new-list
  [node]
  (assoc {} :head node))

</code>
		</pre>
		</p>
		<p>
		Unlike in a language like Java, where I would be creating a Node class and List class, here I'm creating functions that return the data structure that I want. Realistically, I don't need to create these functions, as they are simply creating maps with specified values, but I like the abstraction. Like any good Linked List, I also need to be able to add Nodes to the List. In my head, I think of adding a Node in two ways: at the beginning and at the end (I guess I also think about inserting a Node in the middle, but I didn't do that here). With that in mind I created the following functions:
		<pre>
<code class="clojure">
;; Prepends a Node to the passed in List
(defn prepend
  [list node]
  (->> list
       :head
       (assoc node :next)
       (assoc list :head)))


</code>
		</pre>
		<sub>Sidenote: My first intuition is to defend my code because I assume it isn't "idiomatic" (which is typically an underhanded way of someone saying that your code isn't written in the way the other person likes), but I'm gonna leave it here just the way it is cuz I like the look of it.</sub>
		<p> <code>Prepend</code> is pretty straightforward. It:</p>
		<p>- accepts a List and a Node to prepend</p>
		<p>- gets the <code>head</code> of the passed in List</p>
		<p>- associates that value as the <code>next</code> value of the passed in Node and returns the new Node</p>
		<p>- finally, associates that new Node as the new <code>head</code> property of the List and returns the new List.</p>
		<p><code>Prepend</code> is that simple because at the end of the day I just need to change a couple of values and those values are accessible without any looping or recursion. That's important because the next function, <code>append</code> requires some looping in order to append a Node to the end of the List and due to Clojure's immutable data structures that ended up being trickier than I thought.</p>
		</p>
		<pre>
<code class="clojure">
;; Appends a Node to the passed in List
(defn append
  [list node]
  (loop [n (:head list)
	 path [:head]]
	(if (:next n)
	  (recur (:next n) (conj path :next))
	  (assoc-in list (conj path :next) node))))

</code>
		</pre>
		<p>
		In mutation-land, appending a Node to the end of a List is trivial - loop until the end of the List, append. This only works, however, because I have the ability to <i>mutate</i> the List such that the tail Node's <code>next</code> property is updated to be the inserted Node. In the world of Clojure's immutable data structures though, I have to make sure that I am returning the updated List and not rely on side-effects to change the original. After thinking about it a bit, the solution I came up with involves looping over the List while keeping track of the "path" of where I am in the list (<code>assoc-in</code> is very useful here since it takes a vector of keys - not sure how I would do this otherwise). Once I find that I am at the end of the list, I use <code>assoc-in</code> to update the List at that path by appending the passed in Node as the <code>next</code> property of the current tail Node and then returning the updated List.
		</p>
		<p>
		Now that I finished giving myself some basic functions to create Nodes and Lists, prepend and append, I had to figure out how to reverse one. The pattern I used for this, as you'll see, is similar to the pattern for appending, since I want to perform a similar looping action.
		<pre>
<code class="clojure">
;; Reverse a given list
(defn ll-reverse
  [list]
  (loop [current (:head list)
	 prev nil
	 next nil
	 l list
	 path [:head]]
	(if current
	  (let [path (conj path :next)
		next (:next current)
		new-current (assoc current :next prev)
		l (assoc-in l path prev)
		prev new-current
		current next]
	    (recur current prev next l path))
	    (assoc l :head prev))))

</code>
		</pre>
		</p>
		<p>
		The general algorithm for reversing remains the same, but gets updated slightly to deal with immutability. I loop over the List in the same way as I did with <code>append</code>, keeping track of the "path" into the List. I use 3 variables to keep track of the previous, current and next Nodes, as well as the list itself. That part is a bit different than the norm because I need to update the list, return it, and pass it to the next <code>recur</code> block in order to effectively alter each Node's <code>next</code> property to switch to the "previous" Node. Each recur block walks through the process of changing the assignment of the <code>path</code>, <code>next</code>, <code>prev</code> and <code>current</code> variables in order for the Node's in the List to point to their new <code>next</code>'s. Also, instead of simply "switching" the <code>next</code> pointer of each Node as a side-effect, I need to update the property of the Node and return the updated Node as the new <code>current</code> Node. That part is also a little different because I can't rely on side-effects and mutation to update each Node.
		</p>
		<p>
		After all of that, what I end up with is a set of code that allows me to create Nodes and Lists, prepend, append and reverse Lists.
		<pre>
<code class="clojure-repl">
;; Create Nodes - same repeated for n2 and n3
user=> (def n1 (new-node 1))
#'user/n1
user=> n1
{:val 1, :next nil}

;; Create list
user=> (def l1 (new-list n1))
#'user/l1
user=> l1
{:head {:val 1, :next nil}}

;; Prepend
user=> (def l2 (prepend l1 n2))
#'user/l2
user=> l2
{:head {:val 2, :next {:val 1, :next nil}}}

;; Append
user=> (def l3 (append l2 n3))
#'user/l3
user=> l3
{:head {:val 2, :next {:val 1, :next {:val 3, :next nil}}}}

;; Reverse
user=> (def reversed (ll-reverse l3))
#'user/reversed
user=> reversed
{:head {:val 3, :next {:val 1, :next {:val 2, :next nil}}}}

;; The reverse of the reversed List is equal to the original
user=> (= l3 (ll-reverse reversed))
true

</code>
		</pre>
		</p>
		<p>Well, there you have it - reversing a Linked List in Clojure. It was a fun exercise and I'm glad I did it. Moral of the story - immutability still breaks my brain sometimes.
		</p>
	</div>
</article>
<hr>
<article>
	<header>
		<h3>
			Kafka and Websockets
			<span class="view clickable" onclick="toggleView(this);">
				Show
			</span>

		</h3>
	</header>
	<div style="display: none;">

		<i><p>Posted on <time>Sun Jan 14 2018</time> by <a href="#about">forrestbthomas</a></p></i>
		<p>So, here is my second blog post in as many weeks. Go me! I didn't get as much coding in this week as I would have liked, but that's just kind of the way life goes sometimes. I did a bit of optimization on my deployment for this blog, but that didn't take too much work. It's interesting because with something like this blog, I wonder if I even needed to do it at all. I mean, it's nice that I don't have to do anything other than push to <a href="https://github.com/forrestbthomas">GitHub</a> now and my blog is updated, but I spent several hours setting it up. If I were to count the total time it would take me to simply copy and paste this <code>index.html</code> file over to S3 over the course of my life, I'm not sure it would ever amount to several hours. I guess that's neither here nor there, since it's done now. Lol. It did give me the chance to learn a bit about Git <a href="https://git-scm.com/book/gr/v2/Customizing-Git-Git-Hooks">commit hooks</a> , which was nice. There was one instance in my deployment this week where I had a syntax problem in my <code>config.yml</code> file and didn't know it until it went into <a href="https://circleci.com">CircleCI</a>. Well, that's not ideal, obviously. What I ended up doing is running a <a href="https://npmjs.com/package/yaml-lint">YAML linter</a> before each commit. Supposedly, if that pre-commit hook exits with a non-zero code the commit is supposed to abort. I haven't found that to be the case, but at the very least the YAML linter runs every commit and outputs any errors, so I can always make changes and commit again. </p>
		<p>I also got to spend a little bit of time with my Kafka/Twitter project. This time on the <a href="https://github.com/forrestbthomas/kafka-frontend">front end</a>. As you may have guessed from my previous post, front end development isn't at the top of my list of interests, but I do enjoy it at times. This was one of them. My setup so far is pretty straightforward. I have a <a href="https://kafka.apache.org/">Kafka</a> producer that connects to the free <a href="https://developer.twitter.com/en/docs/tweets/filter-realtime/overview">Twitter Streaming API</a> and filters the stream on keywords that I specify, then it takes those tweets and puts them on a Kafka topic. Next, I use <a href="http://www.onyxplatform.org/">Onyx</a> as my stream processor and Kafka consumer to read in those tweets, conform them, analyze sentiment, and place those output segments onto a separate Kafka topic. That whole part of the project is written in Clojure and I have to say was a lot of fun. The part I started working on this last week was a front end app that would essentially get those sentiment-analyzed tweets and overlay the sentiment on a map of the US. The sentiment would be represented as colors (0 = red, 2 = yellow, 4 = green) and the tweets would be grouped by lat/long coordinates and placed on a D3 map. I ended up using <a href="https://plot.ly/">Plot.ly</a> for the map because it was way easier than rolling my own D3 outline of the US and also added a nice API on top that made it easier for me to overlay colored bubbles by lat/long coordinates. On the API side of the app, I used raw <a href="https://nodejs.org/en/">Node.js</a> as a static server of assets as well as a consumer of the Kafka topic. That part was interesting and I'm not sure I like my approach yet, so we'll see how it goes. But, basically, it didn't appear as though there was a lot of packages available (or regularly maintained) that turned a Node server into a Kafka consumer, so I just used Node's <a href="https://nodejs.org/dist/latest-v8.x/docs/api/child_process.html">child_process</a> module to run the built-in command line Kafka consumer and used stdout and stderr to determine what to do with the message. I created a websocket connection between the front end and the node server, so that anytime the kafka consumer got a new tweet, it would broadcast that tweet as JSON to all clients (which in my case was just my browser).</p>
		<p>This generally worked and I was happy to see messages flowing from the Twitter Streaming API and appear as color coded bubbles on my Plot.ly map, but there are certainly some areas that need tweaking. For one, I'm not sure I need a websocket server. There really isn't a need to have bi-directional communication in my use case since the front end is purely static and there isn't even a way for the front end to communicate with the back end at this point. I could just as easily have used regular old HTTP and been just fine. Part of me wonders, though, if I might want to add the ability for the front end to toggle the stream in some way. For example, if I wanted to pause the display of tweets, rewind and playback old tweets for recording and saving, or even add the ability to change keywords on the stream in real-time. There is <i>probably</i> a reason to keep using websockets, so I think I will, but it's good to consider other options. The other that could use some tweaking is the Plot.ly integration. Right now, I'm using an API from Plot.ly that allows me to read in a file (JSON or CSV) and it will plot the graoh accordingly. This is really useful if I already have a data set saved to disk or if I have a static file stored in the cloud. But when I have streaming data that changes constantly, I am having to redraw the whole graph every time. That's gross. And I don't like it. There are definitely better ways of handling the updating of graph data and its display, so I will probably be looking into that this week.</p>
		<p>Well, that's all I have for now. Hopefully, next week I can provide an update on my front end tweaks (if I get around to them) or some other thing that I have learned. Thanks for reading. Take care.</p>
	</div>
</article>
<hr>

		</section>
		<a href="/archive">Archive</a>
		<aside>
			<h3 id="about">About</h3>
			<p>My name is Forrest and I'm a software engineer...I think. I like to learn new things. The keyword there is <strong>new</strong>. But also I like to learn <i>interesting</i> things. What's interesting is entirely subjective and I truly apologize if what I find uninteresting is something that you can't get enough of (really...no sarcasm there...I honestly hate offending people). This is my third attempt at a blog...I'm really bad at it, but I keep coming back to it because it's something I can <i>probably</i> be good at if I try hard enough. If you want to know about me or about what I find interesting or if you're from the HR department of a company I just applied to (you should hire me, I'm awesome) then you can find out all about that stuff in my posts above. Thanks.</p>
			<p>Oh, and if you want to get a hold of me for some reason, you can reach me at <a href="mailto:forrestbthomas@gmail.com" target="_top">forrestbthomas@gmail.com</a></p>
		</aside>

		<footer>
			<p>Copyright 2018 forrestbthomas</p>
		</footer>

		<script src="/scripts/append-html.js"></script>
		<link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=Vollkorn">
		<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">
		<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/clojure-repl.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/clojure.min.js"></script>
		<script>hljs.initHighlightingOnLoad();</script>
			</body>

</html>
